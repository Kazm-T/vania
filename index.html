<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy 18th Vania ü§ç</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: radial-gradient(circle at center, #1a0b2e 0%, #050510 100%);
            font-family: 'Montserrat', sans-serif;
            color: white;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            pointer-events: none;
            perspective: 1000px;
            padding-top: 12vh;
        }

        #ui-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
        }

        /* Elegant Name */
        .name {
            font-family: 'Playfair Display', serif;
            font-size: 5.5rem;
            margin: 0;
            letter-spacing: 2px;
            color: #fff;
            text-shadow: 0px 5px 25px rgba(255, 182, 193, 0.4);
            transform: translateZ(60px);
            pointer-events: auto;
            transition: all 0.5s ease;
            cursor: default;
            animation: breathe 4s infinite alternate ease-in-out;
        }

        @keyframes breathe {
            0% { transform: translateZ(60px) scale(1); text-shadow: 0px 5px 20px rgba(255, 182, 193, 0.3); }
            100% { transform: translateZ(60px) scale(1.02); text-shadow: 0px 5px 35px rgba(255, 182, 193, 0.7); }
        }

        .name:hover {
            transform: translateZ(80px) scale(1.08);
            text-shadow: 0px 10px 40px rgba(255, 182, 193, 0.9), 0 0 60px rgba(255,255,255,0.6);
        }

        .glow-move {
            animation: magicGlow 3s infinite alternate ease-in-out !important;
            color: #ffdae0;
        }

        @keyframes magicGlow {
            0% { text-shadow: 0 0 20px rgba(255,192,203,0.5); transform: translateZ(60px) translateY(0px); }
            100% { text-shadow: 0 0 40px rgba(255,192,203,1), 0 0 80px rgba(255,255,255,0.9); transform: translateZ(70px) translateY(-15px); }
        }

        /* Premium Premium 3D Timer */
        .timer-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            transform: translateZ(40px);
            opacity: 1;
            transition: opacity 1.5s ease;
        }

        .time-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            padding: 15px 22px;
            border-radius: 16px;
            border: 1px solid rgba(255, 218, 224, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            border-left: 1px solid rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4), inset 0 0 15px rgba(255,255,255,0.05);
        }

        .time-val { font-size: 2.5rem; font-weight: 500; font-family: 'Playfair Display', serif; }
        .time-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 3px; color: #ffc2cd; margin-top: 5px; font-weight: 600;}

        /* Romantic Message */
        .message {
            position: absolute;
            bottom: 15vh;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 2.2rem;
            color: #fff0f5;
            text-shadow: 0 0 20px rgba(255, 182, 193, 0.9);
            opacity: 0;
            transform: translateY(30px) translateZ(50px);
            transition: opacity 2.5s ease, transform 2.5s ease;
            text-align: center;
            width: 100%;
        }

        .message.show {
            opacity: 1;
            transform: translateY(0px) translateZ(50px);
        }

        .signature {
            font-size: 1.2rem; 
            font-family: 'Montserrat', sans-serif; 
            font-style: normal; 
            display: block; 
            margin-top: 15px;
            color: #ffdae0;
            letter-spacing: 2px;
            font-weight: 300;
        }

        @media (max-width: 768px) {
            .name { font-size: 4rem; }
            .timer-container { gap: 8px; }
            .time-box { padding: 12px 15px; }
            .time-val { font-size: 1.8rem; }
            .time-label { font-size: 0.6rem; letter-spacing: 1px;}
            .message { font-size: 1.8rem; bottom: 12vh;}
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="ui-layer">
        <div id="ui-content">
            <h1 class="name" id="main-name">Vania</h1>
            
            <div class="timer-container" id="countdown">
                <div class="time-box"><span class="time-val" id="days">00</span><span class="time-label">Days</span></div>
                <div class="time-box"><span class="time-val" id="hours">00</span><span class="time-label">Hours</span></div>
                <div class="time-box"><span class="time-val" id="minutes">00</span><span class="time-label">Mins</span></div>
                <div class="time-box"><span class="time-val" id="seconds">00</span><span class="time-label">Secs</span></div>
            </div>
        </div>
        
        <div class="message" id="romantic-message">
            Make a wish‚Ä¶ I hope I‚Äôm part of it ‚ú®<br>
            <span class="signature">ü§ç kazm</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // ==========================================
        // TIME CONFIGURATION (GMT+3)
        // ==========================================
        // 24 Feb 2026 00:00:00 (GMT+3) = 23 Feb 2026 21:00:00 (UTC)
        const birthdayDate = Date.UTC(2026, 1, 23, 21, 0, 0);

        // ==========================================
        // SCENE SETUP
        // ==========================================
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x0a0515, 0.035); // Magical purple/blue fog

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = window.innerWidth < 768 ? 8.5 : 6.5;
        camera.position.y = 1.5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // ==========================================
        // LIGHTING
        // ==========================================
        const ambientLight = new THREE.AmbientLight(0xffe4e1, 0.2); // Soft pink ambient
        scene.add(ambientLight);

        const moonLight = new THREE.DirectionalLight(0xaabbff, 0.6); // Cool moonlight
        moonLight.position.set(-5, 15, -10);
        scene.add(moonLight);

        const cakeSpotlight = new THREE.SpotLight(0xffdae0, 1.5); // Warm spotlight on cake
        cakeSpotlight.position.set(0, 8, 2);
        cakeSpotlight.angle = Math.PI / 6;
        cakeSpotlight.penumbra = 0.8;
        scene.add(cakeSpotlight);

        // ==========================================
        // BACKGROUND (MOON & STARS)
        // ==========================================
        // Glowing Moon
        const moonGeo = new THREE.SphereGeometry(3, 32, 32);
        const moonMat = new THREE.MeshBasicMaterial({ color: 0xfff5ea });
        const moon = new THREE.Mesh(moonGeo, moonMat);
        moon.position.set(15, 10, -30);
        scene.add(moon);

        const moonGlow = new THREE.Mesh(
            new THREE.SphereGeometry(3.5, 32, 32),
            new THREE.MeshBasicMaterial({ color: 0xffe4b5, transparent: true, opacity: 0.15, blending: THREE.AdditiveBlending })
        );
        moonGlow.position.copy(moon.position);
        scene.add(moonGlow);

        // Stars
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = new Float32Array(starCount * 3);
        for(let i = 0; i < starCount * 3; i++) {
            starPos[i] = (Math.random() - 0.5) * 80;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.04, transparent: true, opacity: 0.6 });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // ==========================================
        // 3D CAKE & CANDLE
        // ==========================================
        const cakeGroup = new THREE.Group();
        cakeGroup.position.y = -2.5; 
        scene.add(cakeGroup);

        // Glass/Crystal Plate
        const plateGeo = new THREE.CylinderGeometry(2.8, 2.2, 0.15, 64);
        const plateMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.1, metalness: 0.8, transparent: true, opacity: 0.7 });
        const plate = new THREE.Mesh(plateGeo, plateMat);
        plate.position.y = -0.075;
        cakeGroup.add(plate);

        // Base Tier
        const cakeBaseGeo = new THREE.CylinderGeometry(2, 2, 1.5, 64);
        const cakeBaseMat = new THREE.MeshStandardMaterial({ color: 0xffe4e1, roughness: 0.6, metalness: 0.1 });
        const cakeBase = new THREE.Mesh(cakeBaseGeo, cakeBaseMat);
        cakeBase.position.y = 0.75;
        cakeGroup.add(cakeBase);

        // Frosting
        const dripMat = new THREE.MeshStandardMaterial({ color: 0xffb6c1, roughness: 0.3, metalness: 0.1 });
        const dripTorus = new THREE.Mesh(new THREE.TorusGeometry(2, 0.15, 32, 64), dripMat);
        dripTorus.rotation.x = Math.PI / 2;
        dripTorus.position.y = 1.5;
        cakeGroup.add(dripTorus);

        for (let i = 0; i < 14; i++) {
            const angle = (i / 14) * Math.PI * 2;
            const drop = new THREE.Mesh(new THREE.SphereGeometry(0.15, 16, 16), dripMat);
            drop.position.set(Math.cos(angle) * 2, 1.4 - Math.random() * 0.5, Math.sin(angle) * 2);
            drop.scale.y = 1.8;
            cakeGroup.add(drop);
        }

        // Golden Sprinkles
        const sprinkleGeo = new THREE.CylinderGeometry(0.02, 0.02, 0.15, 8);
        const sprinkleMat = new THREE.MeshStandardMaterial({ color: 0xffd700, roughness: 0.2, metalness: 0.8 });
        for(let i=0; i<40; i++) {
            const sprinkle = new THREE.Mesh(sprinkleGeo, sprinkleMat);
            const radius = Math.random() * 1.7;
            const angle = Math.random() * Math.PI * 2;
            sprinkle.position.set(Math.cos(angle) * radius, 1.52, Math.sin(angle) * radius);
            sprinkle.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
            cakeGroup.add(sprinkle);
        }

        // Candle
        const candleGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.8, 32);
        const candleMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.4 });
        const candle = new THREE.Mesh(candleGeo, candleMat);
        candle.position.y = 1.9;
        cakeGroup.add(candle);

        const hitBoxGeo = new THREE.SphereGeometry(1.2, 16, 16);
        const hitBoxMat = new THREE.MeshBasicMaterial({ visible: false });
        const candleHitBox = new THREE.Mesh(hitBoxGeo, hitBoxMat);
        candleHitBox.position.y = 2.4;
        cakeGroup.add(candleHitBox);

        // Flame
        const flameGeo = new THREE.SphereGeometry(0.08, 16, 16);
        const flameMat = new THREE.MeshBasicMaterial({ color: 0xffbb00, transparent: true, opacity: 0.9 });
        const flame = new THREE.Mesh(flameGeo, flameMat);
        flame.scale.set(1, 2.5, 1);
        flame.position.y = 2.4;
        cakeGroup.add(flame);

        const glowGeo = new THREE.SphereGeometry(0.18, 16, 16);
        const glowMat = new THREE.MeshBasicMaterial({ color: 0xff5500, transparent: true, opacity: 0.5, blending: THREE.AdditiveBlending });
        const flameGlow = new THREE.Mesh(glowGeo, glowMat);
        flameGlow.scale.set(1.5, 2.5, 1.5);
        flameGlow.position.y = 2.4;
        cakeGroup.add(flameGlow);

        const flameLight = new THREE.PointLight(0xffaa00, 0, 12);
        flameLight.position.y = 2.4;
        cakeGroup.add(flameLight);

        let isBirthday = Date.now() >= birthdayDate;
        let isCandleLit = isBirthday;
        let candleBlownOut = false;

        if (isCandleLit) {
            flame.visible = true; flameGlow.visible = true; flameLight.intensity = 2.5;
        } else {
            flame.visible = false; flameGlow.visible = false; flameLight.intensity = 0;
        }

        // ==========================================
        // MAGIC DUST (FIREFLIES)
        // ==========================================
        function createGlowTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            grad.addColorStop(0, 'rgba(255, 215, 0, 1)');
            grad.addColorStop(0.2, 'rgba(255, 182, 193, 0.8)');
            grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        }

        const magicDustGeo = new THREE.BufferGeometry();
        const magicDustCount = 60;
        const magicDustPos = new Float32Array(magicDustCount * 3);
        const magicDustPhases = new Float32Array(magicDustCount);
        
        for(let i=0; i<magicDustCount; i++) {
            magicDustPos[i*3] = (Math.random() - 0.5) * 6;
            magicDustPos[i*3+1] = -2 + Math.random() * 6;
            magicDustPos[i*3+2] = (Math.random() - 0.5) * 6;
            magicDustPhases[i] = Math.random() * Math.PI * 2;
        }
        
        magicDustGeo.setAttribute('position', new THREE.BufferAttribute(magicDustPos, 3));
        magicDustGeo.setAttribute('phase', new THREE.BufferAttribute(magicDustPhases, 1));
        
        const magicDustMat = new THREE.PointsMaterial({
            size: 0.15, map: createGlowTexture(), transparent: true, blending: THREE.AdditiveBlending, depthWrite: false
        });
        
        const magicDust = new THREE.Points(magicDustGeo, magicDustMat);
        scene.add(magicDust);

        // ==========================================
        // PARTICLES (SMOKE & HEARTS)
        // ==========================================
        function createHeartTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ff69b4';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ff1493';
            ctx.beginPath();
            ctx.moveTo(64, 40);
            ctx.bezierCurveTo(64, 30, 50, 10, 30, 10);
            ctx.bezierCurveTo(0, 10, 0, 45, 0, 45);
            ctx.bezierCurveTo(0, 70, 30, 95, 64, 120);
            ctx.bezierCurveTo(98, 95, 128, 70, 128, 45);
            ctx.bezierCurveTo(128, 45, 128, 10, 98, 10);
            ctx.bezierCurveTo(78, 10, 64, 30, 64, 40);
            ctx.fill();
            return new THREE.CanvasTexture(canvas);
        }

        const heartTexture = createHeartTexture();
        let hearts = [];
        let smokeParticles = [];
        let confettiParticles = null;

        function createSmoke() {
            const smokeGeo = new THREE.SphereGeometry(0.05, 8, 8);
            const smokeMat = new THREE.MeshBasicMaterial({ color: 0xcccccc, transparent: true, opacity: 0.5 });
            for(let i=0; i<20; i++) {
                const smoke = new THREE.Mesh(smokeGeo, smokeMat.clone());
                smoke.position.set((Math.random()-0.5)*0.2, 2.4+Math.random()*0.2, (Math.random()-0.5)*0.2);
                smoke.userData = { vx: (Math.random()-0.5)*0.015, vy: 0.02+Math.random()*0.02, vz: (Math.random()-0.5)*0.015, life: 1.0 };
                cakeGroup.add(smoke);
                smokeParticles.push(smoke);
            }
        }

        function createFloatingHearts() {
            const heartMat = new THREE.SpriteMaterial({ map: heartTexture, transparent: true, opacity: 1, depthWrite: false, blending: THREE.AdditiveBlending });
            for(let i=0; i<25; i++) {
                const heart = new THREE.Sprite(heartMat.clone());
                heart.position.set((Math.random()-0.5)*2, 2.4, (Math.random()-0.5)*2);
                heart.scale.set(0.4, 0.4, 0.4);
                heart.userData = { vx: (Math.random()-0.5)*0.03, vy: 0.04+Math.random()*0.03, vz: (Math.random()-0.5)*0.03, rot: (Math.random()-0.5)*0.1, life: 1.0 };
                cakeGroup.add(heart);
                hearts.push(heart);
            }
        }

        function triggerConfetti() {
            const confCount = 600;
            const confGeo = new THREE.BufferGeometry();
            const confPos = new Float32Array(confCount * 3);
            const confColors = new Float32Array(confCount * 3);
            const colorPalette = [new THREE.Color(0xffb6c1), new THREE.Color(0xffd700), new THREE.Color(0xffffff), new THREE.Color(0xffaadd)];

            for(let i=0; i<confCount; i++) {
                confPos[i*3] = (Math.random() - 0.5) * 20;
                confPos[i*3+1] = 10 + Math.random() * 10;
                confPos[i*3+2] = (Math.random() - 0.5) * 10 - 2;

                const col = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                confColors[i*3] = col.r; confColors[i*3+1] = col.g; confColors[i*3+2] = col.b;
            }

            confGeo.setAttribute('position', new THREE.BufferAttribute(confPos, 3));
            confGeo.setAttribute('color', new THREE.BufferAttribute(confColors, 3));

            const confMat = new THREE.PointsMaterial({ size: 0.12, vertexColors: true, transparent: true, opacity: 0.9, blending: THREE.AdditiveBlending });
            confettiParticles = new THREE.Points(confGeo, confMat);
            scene.add(confettiParticles);
        }

        // ==========================================
        // INTERACTIVITY
        // ==========================================
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('pointerdown', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            
            if (isBirthday && isCandleLit && !candleBlownOut) {
                const intersects = raycaster.intersectObjects([candleHitBox, flame, flameGlow]);
                if (intersects.length > 0) blowOutCandle();
            }
        });

        function blowOutCandle() {
            isCandleLit = false;
            candleBlownOut = true;
            flame.visible = false;
            flameGlow.visible = false;
            
            let fadeInterval = setInterval(() => {
                flameLight.intensity -= 0.15;
                if(flameLight.intensity <= 0) { flameLight.intensity = 0; clearInterval(fadeInterval); }
            }, 50);

            createSmoke();
            createFloatingHearts();
            document.getElementById('romantic-message').classList.add('show');
        }

        // ==========================================
        // COUNTDOWN TIMER
        // ==========================================
        function updateTimer() {
            const distance = birthdayDate - Date.now();

            if (distance <= 0) {
                if (!isBirthday) {
                    isBirthday = true;
                    if (!candleBlownOut) {
                        isCandleLit = true; flame.visible = true; flameGlow.visible = true;
                    }
                    document.getElementById('countdown').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('countdown').style.display = 'none';
                        const nameEl = document.getElementById('main-name');
                        nameEl.innerHTML = "Happy 18, Vania ü§ç";
                        nameEl.classList.add('glow-move');
                        triggerConfetti();
                    }, 1500);
                }
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').innerText = days < 10 ? '0' + days : days;
            document.getElementById('hours').innerText = hours < 10 ? '0' + hours : hours;
            document.getElementById('minutes').innerText = minutes < 10 ? '0' + minutes : minutes;
            document.getElementById('seconds').innerText = seconds < 10 ? '0' + seconds : seconds;
        }

        if (isBirthday) {
            document.getElementById('countdown').style.display = 'none';
            const nameEl = document.getElementById('main-name');
            nameEl.innerHTML = "Happy 18, Vania ü§ç";
            nameEl.classList.add('glow-move');
            triggerConfetti();
        }

        // ==========================================
        // PARALLAX
        // ==========================================
        let targetX = 0, targetY = 0;
        const uiContent = document.getElementById('ui-content');
        document.addEventListener('mousemove', (e) => {
            targetX = (e.clientX / window.innerWidth - 0.5) * 2;
            targetY = (e.clientY / window.innerHeight - 0.5) * 2;
        });

        // ==========================================
        // ANIMATION LOOP
        // ==========================================
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Smooth Camera
            camera.position.x += (targetX * 1.5 - camera.position.x) * 0.05;
            camera.position.y += (-targetY * 1.5 + 1.5 - camera.position.y) * 0.05;
            camera.lookAt(0, 0, 0);

            uiContent.style.transform = `rotateY(${targetX * 8}deg) rotateX(${-targetY * 8}deg)`;
            
            // Environment Animation
            stars.rotation.y = time * 0.015;
            moon.position.y = 10 + Math.sin(time * 0.5) * 0.5;
            moonGlow.position.copy(moon.position);

            // Floating Cake
            cakeGroup.position.y = -2.5 + Math.sin(time * 1.5) * 0.1;

            // Magic Dust (Fireflies) Animation
            const dustPositions = magicDust.geometry.attributes.position.array;
            const phases = magicDust.geometry.attributes.phase.array;
            for(let i=0; i<magicDustCount; i++) {
                dustPositions[i*3+1] += Math.sin(time * 2 + phases[i]) * 0.005; 
                dustPositions[i*3] += Math.cos(time + phases[i]) * 0.005;
            }
            magicDust.geometry.attributes.position.needsUpdate = true;
            magicDust.rotation.y = time * 0.1;

            if (isCandleLit) {
                flame.scale.x = 1 + Math.sin(time * 30) * 0.05;
                flame.scale.z = 1 + Math.cos(time * 30) * 0.05;
                flame.scale.y = 2.5 + Math.sin(time * 20) * 0.1;
                flameGlow.scale.x = 1.5 + Math.sin(time * 15) * 0.1;
                flameGlow.scale.y = 2.5 + Math.cos(time * 15) * 0.1;
                flameLight.intensity = 2.5 + Math.sin(time * 25) * 0.3;
            }

            for(let i = smokeParticles.length - 1; i >= 0; i--) {
                const p = smokeParticles[i];
                p.position.add(new THREE.Vector3(p.userData.vx, p.userData.vy, p.userData.vz));
                p.scale.addScalar(0.015);
                p.userData.life -= 0.015;
                p.material.opacity = p.userData.life * 0.5;
                if(p.userData.life <= 0) { cakeGroup.remove(p); smokeParticles.splice(i, 1); }
            }

            for(let i = hearts.length - 1; i >= 0; i--) {
                const h = hearts[i];
                h.position.add(new THREE.Vector3(h.userData.vx, h.userData.vy, h.userData.vz));
                h.material.rotation += h.userData.rot;
                h.userData.life -= 0.006;
                h.material.opacity = h.userData.life;
                if(h.userData.life <= 0) { cakeGroup.remove(h); hearts.splice(i, 1); }
            }

            if (confettiParticles) {
                const positions = confettiParticles.geometry.attributes.position.array;
                for(let i = 1; i < positions.length; i += 3) {
                    positions[i] -= 0.06; 
                    positions[i-1] += Math.sin(time * 2 + i) * 0.03; 
                    if(positions[i] < -5) positions[i] = 10;
                }
                confettiParticles.geometry.attributes.position.needsUpdate = true;
                confettiParticles.rotation.y += 0.002;
            }

            updateTimer();
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.position.z = window.innerWidth < 768 ? 8.5 : 6.5;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>